generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(uuid())
  role          Role     @default(CUSTOMER)
  name          String
  email         String
  password_hash String
  birth_date    DateTime @db.Date
  sex           String
  phone         String?
  created_at    DateTime @default(now())

  haircuts           Haircut[]             @relation("CustomerHaircuts")
  favorites_haircuts UserFavoriteHaircut[]

  customerCheckIns  CheckIn[]        @relation("CustomerCheckIns")
  barberCheckIns    CheckIn[]        @relation("BarberCheckIns")
  userLinksBarber   BarberCustomer[] @relation("UserAsEmployee")
  userLinksCustomer BarberCustomer[] @relation("UserAsCustomer")

  @@map("users")
}

model BarberCustomer {
  id               String @id @default(uuid())
  user_barber_id   String
  user_customer_id String

  barber   User @relation("UserAsEmployee", fields: [user_barber_id], references: [id])
  customer User @relation("UserAsCustomer", fields: [user_customer_id], references: [id])

  @@map("barber_customers")
}

model BarberShop {
  id        String    @id @default(uuid())
  title     String
  phone     String?
  latitude  Decimal
  longitude Decimal
  checkIns  CheckIn[]

  @@map("barber_shops")
}

model Haircut {
  id          String    @id @default(uuid())
  name        String
  description String
  price       Decimal   @db.Decimal(10, 2)
  created_at  DateTime  @default(now())
  updated_at  DateTime?
  image_url   String

  customer    User[]                @relation("CustomerHaircuts")
  favoritedBy UserFavoriteHaircut[]
  checkIns    CheckIn[]

  @@map("haircuts")
}

model UserFavoriteHaircut {
  user_id    String
  haircut_id String

  user    User    @relation(fields: [user_id], references: [id])
  haircut Haircut @relation(fields: [haircut_id], references: [id])

  @@id([user_id, haircut_id])
  @@map("user_favorite_haircuts")
}

model CheckIn {
  id             String    @id @default(uuid())
  created_at     DateTime  @default(now())
  validated_at   DateTime?
  barber_shop_id String
  user_id        String
  barber_id      String
  haircut_id     String
  price          Decimal   @db.Decimal(10, 2)

  user       User       @relation("CustomerCheckIns", fields: [user_id], references: [id])
  barber     User       @relation("BarberCheckIns", fields: [barber_id], references: [id])
  barbershop BarberShop @relation(fields: [barber_shop_id], references: [id])
  haircut    Haircut    @relation(fields: [haircut_id], references: [id])

  @@map("check_ins")
}

enum Role {
  ADMIN
  BARBER
  CUSTOMER
}
